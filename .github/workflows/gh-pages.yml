name: gh-pages
on:
  push:
    branches:
    - master
env:
  CI: false # TODO change to true once warnings have been resolved
  PUBLIC_URL: .
jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v1
      with:
        node-version: 13.x
    - name: config
      run: |
        username="$(git --no-pager log --format=format:'%an' -n 1)"
        email="$(git --no-pager log --format=format:'%ae' -n 1)"
        git config --local user.name "$username"
        git config --local user.email "$email"
        git config --local protocol.version 2
        git submodule update --init --force --recursive --depth=1
    - name: build
      run: |
        npm install
        npm run build
        touch build/.nojekyll
    - name: deploy
      uses: peaceiris/actions-gh-pages@v2
      env:
        ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        PUBLISH_BRANCH: gh-pages
        PUBLISH_DIR: ./build
